angular.module('starter').controller("BafsyViewController",function($log,$scope,$stateParams,$timeout,Bafsy){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id});Bafsy.setValueId($stateParams.value_id);$scope.loadContent=function(){Bafsy.find().then(function(data){$scope.bafsy=data.bafsy;$scope.page_title=data.page_title;if($scope.bafsy.code&&(typeof $scope.bafsy.code==="string")){$scope.is_loading=!0;$timeout(function(){try{var iframe=document.querySelector('#bafsy-iframe[data-value-id="'+$scope.value_id+'"]');iframe=iframe.contentWindow||iframe.contentDocument.document||iframe.contentDocument;iframe.document.open();iframe.document.write($scope.bafsy.code);iframe.document.close()}catch(e){$log.error(e)}
$scope.is_loading=!1},20)}},function(data){$log.error("Bafsy error",data)}).then(function(){$scope.is_loading=!1})};$scope.loadContent()});angular.module("starter").factory('Bafsy',function($pwaRequest){var factory={value_id:null,extendedOptions:{}};factory.setValueId=function(value_id){factory.value_id=value_id};factory.setExtendedOptions=function(options){factory.extendedOptions=options};factory.find=function(){if(!this.value_id){$pwaRequest.reject("[Factory::Bafsy.find] missing value_id")}
var payload=$pwaRequest.getPayloadForValueId(factory.value_id);if(payload!==!1){return $pwaRequest.resolve(payload)}else{return $pwaRequest.get("bafsy/mobile_view/find",angular.extend({urlParams:{value_id:this.value_id}},factory.extendedOptions))}};return factory});Features.insertCSS("","bafsy")