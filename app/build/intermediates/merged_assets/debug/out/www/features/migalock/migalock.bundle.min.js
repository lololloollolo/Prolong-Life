angular.module('starter').controller('MigalockViewController',function($scope,$rootScope,$state,$stateParams,$q,Customer,Dialog,Migalock,Pages,Loader,SB,$sce){angular.extend($scope,{is_loading:!0,isLoggedIn:Customer.isLoggedIn()});Migalock.value_id=$stateParams.value_id;$scope.value_id=$stateParams.value_id;$scope.page_title="Migalock"
$scope.isLoggedIn=Customer.isLoggedIn();$scope.layout1={};$scope.force_login=0;$scope.app_is_locked=0;$scope.layout={};$scope.base_url="";$scope.settings=!1;var migalocks=_.filter(Pages.data.pages,function(feature){return(feature.code==='migalock')});$scope.default_background_image="https://wonderfulengineering.com/wp-content/uploads/2016/01/wallpaper-for-mobile-17.jpg";$scope.description="";$scope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$scope.isLoggedIn=!0;$scope.loadSettings()});$rootScope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){console.log("=======88888888888888============");console.log("=======88888888888888============");console.log("=======88888888888888============");$scope.isLoggedIn=!1;Migalock.load().success(function(data){if(data.records){if(!Customer.isLoggedIn()){if(data.records.force_login==1||data.records.app_is_locked==1){$state.go('migalock-view',{value_id:$scope.value_id},{reload:!1})}else{$state.go("home")}}else{if(data.records.app_is_locked==1&&data.allow_all_customers==0){if(!Customer.customer.can_access_locked_features){console.log("goto locked app screen");$state.go('app-locked',{value_id:$scope.value_id},{reload:!1})}}else{$state.go("home")}}}}).error(function onError(data){Dialog.alert('Error',data.message,'OK')}).finally(function(){$scope.is_loading=!1;Loader.hide()})});$scope.loadSettings=function(){$scope.is_loading=!0;Loader.show();Migalock.load().success(function(data){if(data.records){$scope.force_login=data.records.force_login;$scope.app_is_locked=data.records.app_is_locked;$scope.allow_all_customers=data.allow_all_customers;$scope.migalock_values_data=data.migalock_values_data;$scope.description=data.records.description;$scope.trustedHtml=$sce.trustAsHtml(data.records.description);$scope.settings=!0;if(Customer.isLoggedIn()){if(data.records.app_is_locked==1&&data.allow_all_customers==0){if(!Customer.customer.can_access_locked_features){console.log("goto locked app screen");$state.go('app-locked',{value_id:$scope.value_id},{reload:!1})}}}}else{$scope.settings=!1}}).error(function onError(data){Dialog.alert('Error',data.message,'OK')}).finally(function(){$scope.is_loading=!1;Loader.hide()})}
$scope.loadLayoutSettings=function(){$scope.is_loading=!0;Loader.show();Migalock.loadLayoutSettings().success(function(data){console.log("loadLayoutSettings data");$scope.layout=data.records;$scope.base_url=data.base_url;$scope.pic_path="/images/application/"+data.appId+"/features/migalock/";if(!$scope.layout.layout_type){$scope.layout.layout_type=1}
console.log(data)}).error(function onError(data){Dialog.alert('Error',data.message,'OK')}).finally(function(){$scope.is_loading=!1;Loader.hide()})}
$rootScope.$on('$stateChangeStart',function(event,toState,toParams,fromState,fromParams){if(fromState.name=="migalock-view"||fromState.name=="app-locked"){if(!Customer.isLoggedIn()){if($scope.force_login==1||$scope.app_is_locked==1){event.preventDefault()}}else{if($scope.app_is_locked==1&&$scope.allow_all_customers==0){if(!Customer.customer.can_access_locked_features){console.log("goto locked app screen");event.preventDefault();$state.go('app-locked',{value_id:$scope.value_id},{reload:!1})}}}}});$scope.migalock_login=function(){Customer.display_account_form=!1;Customer.loginModal($scope,function(){$rootScope.$broadcast(SB.EVENTS.PADLOCK.unlockFeatures);if($scope.app_is_locked==1&&$scope.allow_all_customers==0){if(Customer.customer.can_access_locked_features){$state.go("home")}else{console.log("goto locked app screen");$state.go('app-locked',{value_id:$scope.value_id},{reload:!1})}}else{$state.go("home")}})};$scope.migalock_signup=function(){Customer.display_account_form=!0;Customer.loginModal($scope,function(){$rootScope.$broadcast(SB.EVENTS.PADLOCK.unlockFeatures);if($scope.app_is_locked==1&&$scope.allow_all_customers==0){if(Customer.customer.can_access_locked_features){$state.go("home")}else{console.log("goto locked app screen");$state.go('app-locked',{value_id:$scope.value_id},{reload:!1})}}else{$state.go("home")}})};$scope.migalock_logout=function(){$scope.is_loading=!0;Customer.logout().then(function(){$scope.is_loading=!1;$scope.is_loading=!1})};$scope.loadSettings();$scope.loadLayoutSettings()});angular.module('starter').factory('Migalock',function(Application,Pages,Customer,$state,$pwaRequest,$ionicPlatform,$session,Dialog,SB,$ionicPopup){var factory={};factory.value_id=null;factory.age_value=null;factory.setValueId=function(valueId){factory.value_id=valueId;return factory};factory.getValueId=function(){return factory.value_id};factory.onStart=function(){Application.loaded.then(function(){console.log("This is migalock application startup loading testing message");var migalock=_.find(Pages.getActivePages(),{code:'migalock'});if(!migalock){return}
factory.setValueId(migalock.value_id).load().then(function(data){console.log(data);console.log("customer data");console.log(Customer.customer);if(data.records){if(!Customer.isLoggedIn()){if(data.records.force_login==1||data.records.app_is_locked==1){$state.go('migalock-view',{value_id:migalock.value_id},{reload:!1})}}else{if(data.records.app_is_locked==1&&data.allow_all_customers==0){if(!Customer.customer.can_access_locked_features){console.log("goto locked app screen");$state.go('app-locked',{value_id:migalock.value_id},{reload:!1})}}}}}).catch(function(error){console.error('migalock-error',error)})})};factory.load=function(){var migalock=_.find(Pages.getActivePages(),{code:'migalock'});factory.setValueId(migalock.value_id);return $pwaRequest.post('migalock/mobile_view/getmigalocksettings',{data:angular.extend({value_id:migalock.value_id,}),cache:!1})};factory.loadLayoutSettings=function(){return $pwaRequest.post('migalock/mobile_view/getlayoutsettings',{data:angular.extend({value_id:factory.getValueId(),}),cache:!1})};factory.find=function(){if(!this.value_id){return $pwaRequest.reject('[Factory::Migalock.find] missing value_id')}
return $pwaRequest.get('migalock/mobile_view/find',{urlParams:{value_id:this.value_id}})};return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}","migalock")