angular.module('starter').controller('PreviewerListController',function($rootScope,$scope,$stateParams,$state,$timeout,$window,Customer,Dialog,Previewer,AUTH_EVENTS){angular.extend($scope,{isLoading:!0,isLoggedIn:Customer.isLoggedIn(),cardDesign:!1,collection:[],search:{searchValue:''},imagePath:function(path){return IMAGE_URL+path}});Previewer.setValueId($stateParams.value_id);$scope.$on(AUTH_EVENTS.loginSuccess,function(){$scope.isLoggedIn=!0;$scope.loadContent()});$scope.$on(AUTH_EVENTS.logoutSuccess,function(){$scope.isLoggedIn=!1;$scope.loadContent()});$scope.login=function(){$rootScope.loginFeature=!0;Customer.loginModal($scope)};$scope.resetSearch=function(){$timeout(function(){$scope.search.searchValue=''})};$scope.loadContent=function(){if(!$scope.isLoggedIn){$scope.isLoading=!1;return}
Previewer.findall().then(function(result){$scope.collection=result.collection;$scope.cardDesign=result.cardDesign;$scope.pageTitle=result.pageTitle},function(error){Dialog.alert('Error',error.message,'OK')}).then(function(){$scope.isLoading=!1})};$scope.openApp=function(app){if($rootScope.isNotAvailableInOverview()){return}
if(app.key==='__stats__'){return}
Previewer.loadApp(app)};$scope.toggleStarred=function(event,app){event.stopPropagation();$timeout(function(){app.starred=!app.starred});Previewer.toggleStarred(app.id)};$scope.loadContent()});angular.module('starter').factory('Previewer',function($pwaRequest,$window){var factory={value_id:null};factory.setValueId=function(valueId){factory.value_id=valueId};factory.findall=function(){return $pwaRequest.get('previewer/mobile_list/findall',{urlParams:{value_id:factory.value_id}})};factory.toggleStarred=function(appId){return $pwaRequest.get('previewer/mobile_list/togglestarred',{urlParams:{value_id:factory.value_id,appId:appId}})};factory.loadApp=function(app){var prvOnError=function(error){console.error(error)};var prvWriteFile=function(fileEntry,dataObj,callbackSuccess){fileEntry.createWriter(function(fileWriter){fileWriter.onwriteend=function(){callbackSuccess()};fileWriter.onerror=prvOnError;fileWriter.write(dataObj)})};var prvWriteModuleFile=function(content,callbackSuccess){$window.requestFileSystem($window.LocalFileSystem.TEMPORARY,5000,function(fs){fs.root.getFile('module.js',{create:!0,exclusive:!1},function(fileEntry){prvWriteFile(fileEntry,content,callbackSuccess)},prvOnError)})};var prvDeleteFile=function(){$window.resolveLocalFileSystemURL(cordova.file.tempDirectory,function(dir){dir.getFile('module.js',{create:!1},function(fileEntry){fileEntry.remove(function(){},function(error){},function(){})})})};var prvLoadApp=function(domain,key,callbackSuccess){var content="IS_PREVIEW = true;"+"DOMAIN = '"+domain+"';"+"APP_KEY = '"+key+"';"+"BASE_PATH = '/' + APP_KEY;";prvWriteModuleFile(content,callbackSuccess)};$window.webview.subscribeCallback(function(){prvDeleteFile()},function(){prvDeleteFile()});prvLoadApp(app.domain,app.key,function(){$window.webview.loadApp()})};return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.module-previewer .previewer2-search .clear-search{margin-right:6px;border:0;background:transparent;position:absolute;right:0;z-index:5000;top:14px}.module-previewer.previewer-list p{font-weight:700}.module-previewer.previewer-list .star-right{position:absolute;right:0;transform:translateY(-50%);top:50%;font-size:28px!important;padding:20px}.module-previewer.previewer-list .star-grey{color:lightgrey}.module-previewer.previewer-list .star-gold{color:#d4be01!important}.module-previewer.previewer-list i.icon{font-size:17px}.module-previewer.previewer-list i.icon:before{transform:translateY(1px)}.previewer-load{display:block!important}","previewer")